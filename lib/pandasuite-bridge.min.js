!function(e,n){if("function"==typeof define&&define.amd)define("PandaBridge",["exports","lodash/isArray","lodash/isObject","lodash/map","lodash/fromPairs","lodash/startsWith"],n);else if("undefined"!=typeof exports)n(exports,require("lodash/isArray"),require("lodash/isObject"),require("lodash/map"),require("lodash/fromPairs"),require("lodash/startsWith"));else{var t={exports:{}};n(t.exports,e.isArray,e.isObject,e.map,e.fromPairs,e.startsWith),e.PandaBridge=t.exports.default}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,(function(e,n,t,r,i,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function s(e,n,t,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void t(e)}s.done?n(u):Promise.resolve(u).then(r,i)}function u(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var a=e.apply(n,t);function o(e){s(a,r,i,o,u,"next",e)}function u(e){s(a,r,i,o,u,"throw",e)}o(void 0)}))}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n=o(n),t=o(t),r=o(r),i=o(i),a=o(a);var c=function(){};function l(e,n){c.globalReceive.forEach((function(t){t(e,n||[])})),c.eventReceive[e]&&c.eventReceive[e].forEach((function(e){e(n||[])}))}c.initCallBack=null,c.loadCallBack=null,c.updateCallBack=null,c.globalReceive=[],c.eventReceive={},c.waitingSend=[],c.bridge=null,c.isStudio=!1,c.resources=[],c.properties={},c.markers=[],c.isCoreInitialized=!1,c.INITIALIZE="__ps_initialize",c.UPDATE="__ps_update",c.SYNCHRONIZE="synchronize",c.TRIGGER_MARKER="triggerMarker",c.INITIALIZED="__ps_initialized",c.UPDATED="__ps_updated",c.STUDIO="__ps_studio",c.LANGUAGE="__ps_language",c.UNIQUE_ID="__ps_id",c.GET_SNAPSHOT_DATA="__ps_getSnapshotData",c.SET_SNAPSHOT_DATA="__ps_setSnapshotData",c.SNAPSHOT_DATA_RESULT="__ps_snapshotDataResult",c.OPEN_URL="__ps_openUrl",c.GET_SCREENSHOT="__ps_getScreenshot",c.SCREENSHOT_RESULT="__ps_screenshotResult",c.PANDASUITE_HOST_WITH_SCHEME="__ps_pandasuiteHostWithScheme",c.PANDASUITE_DATA_HOST_WITH_SCHEME="__ps_pandasuiteDataHostWithScheme",function(e){if(window.WebViewJavascriptBridge)e(window.WebViewJavascriptBridge);else if(window.WebViewAndroidBridge)e({init:function(e){window.sendMessage=function(n){e(n)}},send:function(e){window.WebViewAndroidBridge.send(e)}});else{if(document.addEventListener("WebViewJavascriptBridgeReady",(function(){e(window.WebViewJavascriptBridge)}),!1),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1){if(window.WVJBCallbacks)return window.WVJBCallbacks.push(e);window.WVJBCallbacks=[e];var n=document.createElement("iframe");n.style.display="none",n.src="https://__bridge_loaded__",document.documentElement.appendChild(n),setTimeout((function(){document.documentElement.removeChild(n)}),0)}window.addEventListener("message",(function(n){"PandaJavascriptBridgeReady"===n.data&&(c.listen(c.STUDIO,(function(){c.isStudio=!0})),c.listen(c.LANGUAGE,(function(e){c.currentLanguage=e&&e.language})),e({init:function(e){window.addEventListener("message",(function(n){"PandaJavascriptBridgeReady"!==n.data&&e(n.data)}),!1)},send:function(e){window!==window.parent&&window.parent.postMessage(e,"*")}}))}),!1)}}((function(e){var n;window.WebViewJavascriptBridge&&e===window.WebViewJavascriptBridge&&void 0===window.WebViewJavascriptBridge.send&&(e={init:(n=e,function(e){n.registerHandler("message",(function(n){e(n)}))}),send:function(e){return function(n){e.callHandler("message",n)}}(e)}),c.bridge=e,c.initCallBack&&c.initCallBack(),e.init((function(e){try{var n=JSON.parse(e);l(n.event,n.args)}catch(e){}})),c.waitingSend.forEach((function(e){c.bridge.send.call(c.bridge,e)})),c.waitingSend=[]})),c.init=function(e){c.initCallBack=e,c.bridge&&c.initCallBack()},c.send=function(e,n){try{var t=JSON.stringify({event:e,args:n});c.bridge?c.bridge.send.call(c.bridge,t):c.waitingSend.push(t)}catch(e){}},c.listen=function(e,n){"function"==typeof e?c.globalReceive.push(e):(void 0===c.eventReceive[e]&&(c.eventReceive[e]=[]),c.eventReceive[e].push(n))},c.unlisten=function(e,n){if(void 0===e&&void 0===n)c.globalReceive=[],c.eventReceive={};else if("function"==typeof e){var t=c.globalReceive.indexOf(e);-1!==t&&c.globalReceive.splice(t,1)}else if(void 0===n)c.eventReceive[e]=[];else{var r=c.eventReceive[e].indexOf(n);-1!==r&&c.eventReceive[e].splice(r,1)}},c.listen(c.INITIALIZE,(function(e){c.isCoreInitialized=!0,c.resources=(e=e||[])[2]||[],c.properties=e[0]||{},c.markers=e[1]||[],c.loadCallBack&&(c.loadCallBack({properties:c.properties,markers:c.markers,resources:c.resources}),c.loadCallBack=null)})),c.onLoad=function(e){(c.loadCallBack=e)&&c.isCoreInitialized&&(c.loadCallBack({properties:c.properties,markers:c.markers,resources:c.resources}),c.loadCallBack=null)},c.listen(c.UPDATE,(function(e){c.resources=(e=e||[])[2]||[],c.properties=e[0]||{},c.markers=e[1]||[],c.updateCallBack&&c.updateCallBack({properties:c.properties,markers:c.markers,resources:c.resources})})),c.onUpdate=function(e){c.updateCallBack=e},c.getSnapshotData=function(e){c.listen(c.GET_SNAPSHOT_DATA,(function(n){c.send(c.SNAPSHOT_DATA_RESULT,[e(n)])}))},c.setSnapshotData=function(e){c.listen(c.SET_SNAPSHOT_DATA,(function(n){e({data:(n=n||[])[0]||{},params:n[1]||{}})}))},c.getScreenshot=function(e){c.listen(c.GET_SCREENSHOT,(function(n){e((function(e){c.send(c.SCREENSHOT_RESULT,[e])}),n)}))},c.takeScreenshot=function(){l(c.GET_SCREENSHOT,null)},c.openUrl=function(e){c.send(c.OPEN_URL,[e])},c.synchronize=function(e,n){"function"==typeof e?c.listen(c.SYNCHRONIZE,(function(n){e(n[0])})):"function"==typeof n&&c.listen(c.SYNCHRONIZE,(function(t){(t||[])[1]===e&&n(t[0])}))},c.resolvePath=function(e,n){var t=c.resources.filter((function(n){return n.id===e&&n.path})),r=t&&t[0];if(r&&c.currentLanguage){var i=t.find((function(e){return e.language===c.currentLanguage}));i&&(r=i)}return r?r.path:n};var d=function(e){return new Promise((function(n,t){var r=new FileReader;r.onloadend=function(){r.error?t(r.error):n(r.result)},r.readAsDataURL(e)}))};c.resolveTypes=function(){var e=u(regeneratorRuntime.mark((function e(o){var s,c,l,f=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,n.default)(o)){e.next=2;break}return e.abrupt("return",Promise.all((0,r.default)(o,(function(e){return f.resolveTypes(e)}))));case 2:if(!(0,t.default)(o)){e.next=26;break}if(s=o.type,c=o.value,"Image"!==s&&"Audio"!==s&&"Video"!==s){e.next=21;break}if((0,a.default)(c,"http")){e.next=20;break}return e.prev=6,e.next=9,fetch(c).then((function(e){if(e.ok)return e.blob();throw new Error}));case 9:return l=e.sent,e.t0=s,e.next=13,d(l);case 13:return e.t1=e.sent,e.abrupt("return",{type:e.t0,value:e.t1});case 17:return e.prev=17,e.t2=e.catch(6),e.abrupt("return",{type:s,value:null});case 20:return e.abrupt("return",o);case 21:return e.t3=i.default,e.next=24,Promise.all((0,r.default)(o,function(){var e=u(regeneratorRuntime.mark((function e(n,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,f.resolveTypes(n);case 3:return e.t1=e.sent,e.abrupt("return",[e.t0,e.t1]);case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()));case 24:return e.t4=e.sent,e.abrupt("return",(0,e.t3)(e.t4));case 26:return e.abrupt("return",o);case 27:case"end":return e.stop()}}),e,null,[[6,17]])})));return function(n){return e.apply(this,arguments)}}();var f=c;e.default=f,Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw TypeError('"this" is null or not defined');var n=Object(this),t=n.length>>>0;if("function"!=typeof e)throw TypeError("predicate must be a function");for(var r=arguments[1],i=0;i<t;){var a=n[i];if(e.call(r,a,i,n))return a;i++}},configurable:!0,writable:!0})}));